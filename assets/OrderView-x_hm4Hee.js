import{_ as y,o,c as l,a as e,t as s,k as O,F as m,l as v,h as k,q as M,m as L,r as _,b as p,w as P}from"./index-_xMUitMs.js";import{a as g,u as C}from"./axios-U3vUtiKk.js";import{m as V,D,P as E}from"./PagePagination-Keoe42zA.js";const U={props:["order"],mixins:[V],data(){return{tempOrder:{}}},watch:{order(){this.tempOrder=this.order}},methods:{}},R={id:"productModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},T={class:"modal-dialog modal-xl"},S={class:"modal-content border-0"},A=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{id:"productModalLabel",class:"modal-title"},[e("span",null,"訂單內容")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),B={class:"modal-body"},I={class:"row"},q={class:"col-md-4"},N=e("h3",{class:"fw-bold"},"用戶資料",-1),j={class:"table"},z={key:0},F=e("th",null,"姓名",-1),H=e("th",null,"Email",-1),G=e("th",null,"電話",-1),J=e("th",null,"地址",-1),K={class:"col-md-8"},Q=e("h3",{class:"fw-bold"},"訂單細節",-1),W={class:"table"},X=e("th",null,"訂單編號",-1),Y=e("th",null,"下單時間",-1),Z=e("th",null,"付款時間",-1),ee={key:0},te={key:1},se=e("th",null,"付款狀態",-1),oe={key:0,class:"text-success"},le={key:1,class:"text-danger"},de=e("th",null,"總金額",-1),ne=e("hr",null,null,-1),ae=e("h3",{class:"fw-bold"},"選購商品",-1),ie={class:"table"},re={class:"fs-5"},ce=e("tbody",null,null,-1),ue={class:"d-flex justify-content-end"},he={class:"form-check"},_e={class:"form-check-label",for:"flexCheckDefault"},pe={key:0,class:"fw-bold"},me={key:1},ge={class:"modal-footer"},be=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function fe(n,d,r,h,t,u){return o(),l("div",R,[e("div",T,[e("div",S,[A,e("div",B,[e("div",I,[e("div",q,[N,e("table",j,[t.tempOrder.user?(o(),l("tbody",z,[e("tr",null,[F,e("td",null,s(t.tempOrder.user.name),1)]),e("tr",null,[H,e("td",null,s(t.tempOrder.user.email),1)]),e("tr",null,[G,e("td",null,s(t.tempOrder.user.tel),1)]),e("tr",null,[J,e("td",null,s(t.tempOrder.user.address),1)])])):O("",!0)])]),e("div",K,[Q,e("table",W,[e("tbody",null,[e("tr",null,[X,e("td",null,s(t.tempOrder.id),1)]),e("tr",null,[Y,e("td",null,s(n.$filters.date(t.tempOrder.create_at)),1)]),e("tr",null,[Z,e("td",null,[t.tempOrder.paid_date?(o(),l("span",ee,s(t.tempOrder.paid_date),1)):(o(),l("span",te,"時間不確定"))])]),e("tr",null,[se,e("td",null,[t.tempOrder.is_paid?(o(),l("strong",oe," 已付款 ")):(o(),l("span",le,"未付款"))])]),e("tr",null,[de,e("td",null,s(t.tempOrder.total),1)])])]),ne,ae,e("table",ie,[e("thead",null,[(o(!0),l(m,null,v(t.tempOrder.products,i=>(o(),l("tr",{key:i.id},[e("th",re,s(i.product.title),1),e("td",null,s(i.qty)+" / "+s(i.product.unit),1),e("td",null,s(i.final_total),1)]))),128))]),ce]),e("div",ue,[e("div",he,[k(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":d[0]||(d[0]=i=>t.tempOrder.is_paid=i)},null,512),[[M,t.tempOrder.is_paid]]),e("label",_e,[t.tempOrder.is_paid?(o(),l("span",pe,"已付款")):(o(),l("span",me,"未付款"))])])])])])]),e("div",ge,[be,e("button",{type:"button",class:"btn btn-primary",onClick:d[1]||(d[1]=i=>n.$emit("update-paid",t.tempOrder))}," 修改付款狀態 ")])])])],512)}const ve=y(U,[["render",fe]]);var ye={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"wei_rio",BASE_URL:"/vue2024_week07/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:b,VITE_PATH:f}=ye,Oe={components:{OrderModal:ve,DelModal:D,PagePagination:E},data(){return{orders:{},pagination:{},isLoading:!1,tempOrder:{},currentPage:1}},created(){this.getOrder()},methods:{...L(C,["pushMessage"]),getOrder(n=1){this.currentPage=n;const d=`${b}api/${f}/admin/orders?page=${n}`;this.isLoading=!0,g.get(d).then(r=>{this.orders=r.data.orders,this.pagination=r.data.pagination,this.isLoading=!1,this.pushMessage({style:"success",title:"成功取得訂單明細",content:r.data.message})}).catch(r=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"訂單明細取得失敗",content:r.response.data.message})})},openModal(n,d){n==="edit"?(this.tempOrder={...d},this.$refs.orderModal.openModal()):n==="del"&&(this.tempOrder={...d},this.$refs.delModal.openModal())},updateOrder(n){this.isLoading=!0;const d=`${b}api/${f}/admin/order/${n.id}`,r={is_paid:n.is_paid};g.put(d,{data:r}).then(h=>{this.isLoading=!1,this.$refs.orderModal.hideModal(),this.getOrder(this.currentPage),this.pushMessage({style:"success",title:"更新付款狀態",content:h.data.message})}).catch(h=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"錯誤訊息",content:h.response.data.message})})},delOder(){this.isLoading=!0;const n=`${b}api/${f}/admin/order/${this.tempOrder.id}`;g.delete(n).then(d=>{this.isLoading=!1,this.$refs.delModal.hideModal(),this.getOrder(this.currentPage),this.pushMessage({style:"success",title:"成功刪除",content:d.data.message})}).catch(d=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"錯誤訊息",content:d.response.data.message})})}}},ke=e("div",{class:"loadingio-spinner-double-ring-0ut21surusy"},[e("div",{class:"ldio-2uwwzn0tw8t"},[e("div"),e("div"),e("div",null,[e("div")]),e("div",null,[e("div")])])],-1),Me={class:"container"},xe=e("div",{class:"d-flex justify-content-between align-items-center"},[e("h2",{class:"my-4 fw-bold"},"訂單明細")],-1),we={class:"table-responsive"},$e={class:"table align-middle table-bordered"},Le=e("thead",{class:"fs-5"},[e("tr",{class:"table-active"},[e("th",{width:"150",class:"text-center d-none d-sm-table-cell"},"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",{width:"120"},"應付金額"),e("th",{width:"140",class:"text-center"},"是否付款"),e("th",{class:"text-center"},"編輯")])],-1),Pe=["textContent"],Ce={class:"list-unstyled"},Ve={class:"form-check form-switch"},De=["id","onUpdate:modelValue","onChange"],Ee=["for"],Ue={key:0,class:"text-success fw-bold"},Re={key:1,class:"text-danger"},Te={class:"text-center"},Se={class:"btn-group flex-sm-row flex-column"},Ae=["onClick"],Be=["onClick"];function Ie(n,d,r,h,t,u){const i=_("VueLoading"),x=_("OrderModal"),w=_("DelModal"),$=_("PagePagination");return o(),l(m,null,[p(i,{active:t.isLoading,"z-index":1060},{default:P(()=>[ke]),_:1},8,["active"]),e("div",Me,[xe,e("div",we,[e("table",$e,[Le,e("tbody",null,[(o(!0),l(m,null,v(t.orders,a=>(o(),l("tr",{key:a.id},[e("td",null,s(n.$filters.date(a.create_at)),1),e("td",null,[a.user?(o(),l("span",{key:0,textContent:s(a.user.email)},null,8,Pe)):O("",!0)]),e("td",null,[e("ul",Ce,[(o(!0),l(m,null,v(a.products,c=>(o(),l("li",{key:c.id},s(c.product.title)+" / "+s(c.qty)+" "+s(c.product.unit),1))),128))])]),e("td",null,s(a.total),1),e("td",null,[e("div",Ve,[k(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${a.id}`,"onUpdate:modelValue":c=>a.is_paid=c,onChange:c=>u.updateOrder(a)},null,40,De),[[M,a.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${a.id}`},[a.is_paid?(o(),l("span",Ue,"付款")):(o(),l("span",Re,"未付款"))],8,Ee)])]),e("td",Te,[e("div",Se,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm mb-sm-0 mb-2",onClick:c=>u.openModal("edit",a)}," 編輯 ",8,Ae),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:c=>u.openModal("del",a)}," 刪除 ",8,Be)])])]))),128))])])]),p(x,{order:t.tempOrder,onUpdatePaid:u.updateOrder,ref:"orderModal"},null,8,["order","onUpdatePaid"]),p(w,{"out-item":t.tempOrder,onRemoveData:u.delOder,ref:"delModal"},null,8,["out-item","onRemoveData"]),p($,{pages:t.pagination,onEmitPages:u.getOrder},null,8,["pages","onEmitPages"])])],64)}const ze=y(Oe,[["render",Ie]]);export{ze as default};
