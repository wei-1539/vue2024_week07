import{_ as v,o as a,c as d,a as e,h as c,v as r,q as k,t as g,m as L,r as h,b as _,w as V,F as C,l as D}from"./index-_xMUitMs.js";import{a as f,u as P}from"./axios-U3vUtiKk.js";import{m as T,D as E,P as N}from"./PagePagination-Keoe42zA.js";const U={props:["coupon","isNew"],mixins:[T],data(){return{tempCoupon:{},due_date:""}},emits:["update-coupon"],watch:{coupon(){this.tempCoupon=this.coupon;const s=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=s},due_date(){}}},R={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},A={class:"modal-dialog",role:"document"},I={class:"modal-content"},S={class:"modal-header"},B={class:"modal-title",id:"exampleModalLabel"},O={key:0},z={key:1},F=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),H={class:"modal-body"},j={class:"mb-3"},q=e("label",{for:"title"},"標題",-1),G={class:"mb-3"},J=e("label",{for:"coupon_code"},"優惠碼",-1),K={class:"mb-3"},Q=e("label",{for:"due_date"},"到期日",-1),W={class:"mb-3"},X=e("label",{for:"price"},"折扣百分比",-1),Y={class:"mb-3"},Z={class:"form-check"},ee=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),te={class:"modal-footer"},oe=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function se(s,t,n,p,o,l){return a(),d("div",R,[e("div",A,[e("div",I,[e("div",S,[e("h5",B,[n.isNew?(a(),d("span",O,"新增優惠卷")):(a(),d("span",z,"編輯優惠卷"))]),F]),e("div",H,[e("div",j,[q,c(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=i=>o.tempCoupon.title=i),placeholder:"請輸入標題"},null,512),[[r,o.tempCoupon.title]])]),e("div",G,[J,c(e("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[1]||(t[1]=i=>o.tempCoupon.code=i),placeholder:"請輸入優惠碼"},null,512),[[r,o.tempCoupon.code]])]),e("div",K,[Q,c(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=i=>o.due_date=i)},null,512),[[r,o.due_date]])]),e("div",W,[X,c(e("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":t[3]||(t[3]=i=>o.tempCoupon.percent=i),placeholder:"請輸入折扣百分比"},null,512),[[r,o.tempCoupon.percent,void 0,{number:!0}]])]),e("div",Y,[e("div",Z,[c(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=i=>o.tempCoupon.is_enabled=i),id:"is_enabled"},null,512),[[k,o.tempCoupon.is_enabled]]),ee])])]),e("div",te,[oe,e("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=i=>s.$emit("update-coupon",o.tempCoupon))},g(n.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const ne=v(U,[["render",se]]);var ie={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"wei_rio",BASE_URL:"/vue2024_week07/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:m,VITE_PATH:b}=ie,le={components:{CouponModal:ne,DelModal:E,Pagination:N},data(){return{isLoading:!1,coupons:{},isNew:!1,tempCoupon:{title:"",is_enabled:0,percent:100,code:""},currentPage:1,pagination:{}}},created(){this.getCoupons()},methods:{...L(P,["pushMessage"]),getCoupons(s=1){this.currentPage=s,this.isLoading=!0;const t=`${m}/api/${b}/admin/coupons?page=${s}`;f.get(t).then(n=>{this.isLoading=!1,this.coupons=n.data.coupons,this.pagination=n.data.pagination,console.log(n.data),this.pushMessage({style:"success",title:"取得優惠卷資料",content:n.data.message})}).catch(n=>{console.log(n.response),this.isLoading=!1,this.pushMessage({style:"danger",title:"優惠卷資料取得失敗",content:n.response.data.message})})},openModal(s,t){s==="add"?(this.isNew=!0,this.tempCoupon={due_date:new Date().getTime()/1e3},this.$refs.couponModal.openModal()):s==="edit"?(this.isNew=!1,this.tempCoupon={...t},this.$refs.couponModal.openModal()):s==="del"&&(this.tempCoupon={...t},this.$refs.delCoupon.openModal())},updateCoupon(s){this.isLoading=!0,this.tempCoupon=s;let t=`${m}api/${b}/admin/coupon`,n="post",p=s,o="新增優惠卷";this.isNew||(t=`${m}api/${b}/admin/coupon/${this.tempCoupon.id}`,n="put",p=this.tempCoupon,o="更新優惠卷"),f[n](t,{data:p}).then(l=>{this.isLoading=!1,this.pushMessage({style:"success",title:`${o}`,content:l.data.message}),this.getCoupons(this.currentPage),this.$refs.couponModal.hideModal()}).catch(l=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"優惠卷刪除失敗",content:l.response.data.message})})},delCoupon(){this.isLoading=!0;const s=`${m}/api/${b}/admin/coupon/${this.tempCoupon.id}`;f.delete(s).then(t=>{this.isLoading=!1,this.pushMessage({style:"success",title:"成功刪除優惠卷",content:t.data.message}),this.getCoupons(this.currentPage),this.$refs.delCoupon.hideModal()}).catch(t=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"優惠卷刪除失敗",content:t.response.data.message})})}}},ae=e("div",{class:"loadingio-spinner-double-ring-0ut21surusy"},[e("div",{class:"ldio-2uwwzn0tw8t"},[e("div"),e("div"),e("div",null,[e("div")]),e("div",null,[e("div")])])],-1),de={class:"container"},ue={class:"d-flex justify-content-between align-items-center"},ce=e("h2",{class:"my-4 fw-bold"},"優惠卷",-1),pe={class:"table mt-4"},re=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣百分比"),e("th",null,"到期日"),e("th",{class:"text-center"},"是否啟用"),e("th",null,"編輯")])],-1),he={class:"text-center"},_e={key:0,class:"text-success"},me=e("i",{class:"bi bi-check-circle-fill h5"},null,-1),be=[me],ge={key:1,class:"text-danger"},fe=e("i",{class:"bi bi-x-circle-fill h5"},null,-1),Ce=[fe],ve={class:"btn-group flex-sm-row flex-column"},Me=["onClick"],ye=["onClick"];function we(s,t,n,p,o,l){const i=h("VueLoading"),M=h("Pagination"),y=h("CouponModal"),w=h("DelModal");return a(),d(C,null,[_(i,{active:o.isLoading,"z-index":1060},{default:V(()=>[ae]),_:1},8,["active"]),e("div",de,[e("div",ue,[ce,e("button",{class:"btn btn-primary",type:"button",onClick:t[0]||(t[0]=u=>l.openModal("add",s.item))}," 建立新的優惠券 ")]),e("table",pe,[re,e("tbody",null,[(a(!0),d(C,null,D(o.coupons,(u,$)=>(a(),d("tr",{key:$},[e("td",null,g(u.title),1),e("td",null,g(u.percent)+" %",1),e("td",null,g(s.$filters.date(u.due_date)),1),e("td",he,[u.is_enabled?(a(),d("span",_e,be)):(a(),d("span",ge,Ce))]),e("td",null,[e("div",ve,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm mb-sm-0 mb-2",onClick:x=>l.openModal("edit",u)}," 編輯 ",8,Me),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:x=>l.openModal("del",u)}," 刪除 ",8,ye)])])]))),128))])]),_(M,{pages:o.pagination,onEmitPages:l.getCoupons},null,8,["pages","onEmitPages"])]),_(y,{coupon:o.tempCoupon,"is-new":o.isNew,onUpdateCoupon:l.updateCoupon,ref:"couponModal"},null,8,["coupon","is-new","onUpdateCoupon"]),_(w,{"out-item":o.tempCoupon,onRemoveData:l.delCoupon,ref:"delCoupon"},null,8,["out-item","onRemoveData"])],64)}const Le=v(le,[["render",we]]);export{Le as default};
